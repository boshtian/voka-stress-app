<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<title>Stress app</title>
<link rel="stylesheet" href="css/style.css" />

<script src="cordova.js"></script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/jquery.knob.js"></script>
<script src="scripts/jquery-ui.min.js"></script>
<script src="scripts/jquery.ui.touch-punch.js"></script>
<!--<script src="scripts/jquery.mobile-1.1.1.min.js"></script>-->
<script src="scripts/cdv-plugin-fb-connect.js"></script>
<script src="scripts/facebook-js-sdk.js"></script>

<script type="text/javascript" charset="utf-8">
	
	// event listeners
	document.addEventListener("deviceready", onDeviceReady, false);
	
/*
	$(document).ready(function(e) {
    onDeviceReady();
  });
*/
	
	function onDeviceReady() {
		//document.addEventListener("online", onOnline, false);
		document.addEventListener("resume", onResume, false);
		
		document.addEventListener("backbutton", function(e){
			e.preventDefault();
			navigator.app.exitApp();
		}, false);
		/*
		try {
			FB.init({ appId: "530146413715624", nativeInterface: CDV.FB, useCachedDialogs: false });
		} catch (e) {
			alert(e);
		}
		*/
		
		/* Prepare visual of app */
		$("#app-wrapper").height($(window).height());
		
		$('.stress-slider-wrap').height($('.stress-slider-wrap').width() / 2);
		$('.sound-slider-wrap').height($('.sound-slider-wrap').width() / 2);
		
		var sliderWidth = $('.stress-slider').width();
		
		var R = 100;
		
		$('.stress-slider').slider({
			slide: function( event, ui ) {
				var sliderVal = ui.value;
				//$('.stress-slider a').css("top", Math.abs((sliderVal - 50)*2)+"%");
				//$('.stress-slider a').css("top", 100 - (toDegrees(Math.sin(toRadians(sliderVal*1.8)))*2)+"%");
				var Y = (sliderVal*2) - 100;
				$('.stress-slider a').css("top", (100 - (Math.sqrt((R*R) - (Y*Y)))) + "%");
			},
			change: function( event, ui ) {
			},
			stop: function( event, ui ) {
			}
		});
		
		$soundSlider = $('.sound-slider').slider({
			slide: function( event, ui ) {
				var sliderVal = ui.value;
				var Y = (sliderVal*2) - 100;
				$('.sound-slider a').css("top", (Math.sqrt((R*R) - (Y*Y))) + "%");
			},
			change: function( event, ui ) {
			}
		});
	
		var buttonWidth = $('.action-button').width();
		$('.action-button').css('height', buttonWidth+'px').css('line-height', buttonWidth+'px').css("top", (buttonWidth/0.71)*(-1));;
		
		
		/* MUSIC */
		
		var timerInterval;
		var musicPlaying = false;
		var musicDuration;
		var appMusic;
		
		// Create Media object from src
		if (device.platform == "Android") {
			appMusic = new Media("/android_asset/www/music/stress_app_music.mp3", musicSuccess, musicError);
		} else {
			appMusic = new Media("music/stress_app_music.mp3", musicSuccess, musicError);
		}
		
		function musicSuccess(){
			musicDuration = appMusic.getDuration();
		}
		
		function musicError(){
			alert("Can't load music.");
		}
		
		appMusic.seekTo(600000);
		
		$(".action-button").on('touchstart', function(){
			if (!musicPlaying){
				appMusic.play();
				musicPlaying = true;
				timerInterval = setInterval(function(){ updateTimer(appMusic); }, 1000);
				$(this).text("STOP").addClass("playing");
			}
			else{
				appMusic.pause();
				musicPlaying = false;
				clearInterval(timerInterval);
				$(this).text("START").removeClass("playing");
			}
		});
		
		/* Buttons actions */
		$("a.btn-again").on('touchstart', function(){
			$("#app-finished").fadeOut(200);
			$("#app-content h2").fadeIn(100);
		});
		
		$("a.btn-better").on('touchstart', function(){
			$("#app-finished").fadeOut(200);
			$("#app-share").fadeIn(200);
		});
		
		$("a.btn-start").on('touchstart', function(){
			$("#app-share").fadeOut(200);
			$("#app-content h2").fadeIn(100);
		});
		
		$("a.btn-info").on('touchstart', function(){
			$("#app-info").fadeIn(200);
		});
		
		$("a.btn-info-close").on('touchstart', function(){
			$("#app-info").fadeOut(200);
		});
		
		/* End Button Actions */
		
	}
	
	function toDegrees (angle) {
		return angle * (180 / Math.PI);
	}
	
	function toRadians (angle) {
		return angle * (Math.PI / 180);
	}
	
	function updateTimer(appMusic) {
		var m, s;
		
		appMusic.getCurrentPosition(
			function (position) {
				if (position > -1) {
					time = appMusic.getDuration() - position;
					$(".dev-time").text(time+" / "+Math.floor(time)+" / "+Math.round(time));
					if (time == 0){
						$("#app-content h2").fadeOut(200);
						$("#app-finished").fadeIn(200);
						$(".action-button").text("START").removeClass("playing");
					}
					else{		
						time = time / 1000;
						m = Math.floor(time / 60);
						m = isNaN(m) ? "--" : m >= 10 ? m : "0" + m;
						s = Math.floor(time % 60);
						s = isNaN(s) ? "--" : s >= 10 ? s : "0" + s;
						
						$("span.min").text(m);
						$("span.sec").text(s);
					}
				}
			},
			// error callback
			function (e) {
					console.log("Error getting pos=" + e);
			}
		);
	}
	
	function onOnline(){
	}
	
	function onResume(){
	}
	
	/*
	// on mobileinit
	$(document).on("mobileinit", function() {
		$.mobile.buttonMarkup.hoverDelay = 25;
		$.mobile.defaultPageTransition = 'none';
		$.mobile.defaultDialogTransition = 'none';
	  $.mobile.useFastClick = false;
	});
	
	function facebookPostToWall(event) {
		var params = {
				method: 'feed',
				name: 'Tap Water Ljubljana',
				link: 'https://play.google.com/store/apps/details?id=si.enki.tapwaterljubljana',
				picture: arr_images[event.data.mid],
				caption: 'Tap Water Ljubljana',
				description: 'Thirsty in Ljubljana? Install this app and find yourself a free drinking water fountain.'
			};
		FB.ui(params, function(obj) {
			//console.log(obj);
		});
	}
*/	
</script>
</head> 

<body> 

  <div data-role="page" id="app-wrapper">
    <div data-role="content" id="app-content">
      <h2 class="stress-state">Non stressed</h2>
      <div class="circle-slider">
        <div class="stress-slider-wrap"><div class="slider stress-slider"></div></div>
        <div class="sound-slider-wrap"><div class="slider sound-slider"></div></div>
        <div class="action-button">START</div>
        <div class="dev-time"></div>
      </div>
      <div class="timer">
        <div class="title">DURATION:</div>
        <div class="time"><span class="min">00</span>M <span class="sec">00</span>S</div>
      </div>
      <a data-role="button" class="btn-info">INFO</a>
    </div>
    
    <div data-role="content" id="app-finished">
      <h2>Feeling relaxed?</h2>
      <div class="btn-again-wrap">
        <a data-role="button" class="btn-again">Need one more time</a>
      </div>
      <div class="btn-better-wrap">
        <a data-role="button" class="btn-better">I'm better now</a>
      </div>
    </div>
    
    <div data-role="content" id="app-share">
      <h2>I'm better now</h2>
      <div class="buttons-wrapper">
        <div class="social-wrapper">
        	<div class="btn-facebook-wrap">
	          <a data-role="button" class="btn-facebook">Facebook</a>
          </div>
          <div class="btn-twitter-wrap">
	          <a data-role="button" class="btn-twitter">Twitter</a>
          </div>
        </div>
        <div class="btn-share-wrap">
	        <a data-role="button" class="btn-share">Share</a>
        </div>
        <div class="btn-start-wrapper"><a data-role="button" class="btn-start">Start screen</a></div>
      </div>
    </div>
    
    <div data-role="content" id="app-info">
    	<h2>About</h2>
      <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat.<br /><br /></p>
      <p class="align-center"><img src="images/voka-logo.svg" /></p>
      <p class="align-center">JP VODOVOD - KANALIZACIJA d.o.o.<br />Vodovodna cesta 90, SI-1000 Ljubljana<br />www.vo-ka.si</p>
      <p class="align-center">Â© 2013 JP Vodovod - Kanalizacija d.o.o.<br />App Designed: ENKI</p>
      <div class="btn-info-close-wrap">
	      <a data-role="button" class="btn-info-close">Close</a>
      </div>
    </div>
  </div>

</body>
</html>